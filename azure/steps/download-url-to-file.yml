parameters:
# source_url - Required - The path to download
- name: source_url
  type: string
# target_path_including_filename - Required - The full path, including filename, to download the url to
- name: target_path_including_filename
  type: string
# file_path_variable - (Optional)
- name: file_path_variable
  type: string
  default: ''
# name - (Optional)
- name: name
  type: string
  default: 'download'

steps:
  - task: PowerShell@2
    name: ${{ parameters.name }}
    displayName: 'Download url [${{ parameters.source_url }}] to file [${{ parameters.target_path_including_filename }}]'
    inputs:
      targetType: 'inline'
      workingDirectory: $(Pipeline.Workspace)
      script: |
          $file_path = ${{ parameters.target_path_including_filename }};
          Write-Host "Download file from ${{ parameters.source_url }} to $file_path"
          $contents = Invoke-WebRequest '${{ parameters.source_url }}' -UseBasicParsing -OutFile $file_path
          Write-Host "Download complete to $file_path"
          If ($Service -ne "") {
            echo "##vso[task.setvariable variable=${{ parameters.file_path_variable }};isOutput=true]$file_path"
            Write-Host "Output variable set"
          }
